(function(p){p.module("scrollable-table",[]).directive("scrollableTable",["$timeout","$q",function(c,g){return{transclude:!0,restrict:"E",scope:{rows:"=watch",sortFn:"="},template:'<div class="scrollableContainer"><div class="headerSpacer"></div><div class="scrollArea" ng-transclude></div></div>',controller:["$scope","$element","$attrs",function(a,b,k){function l(){function a(){0===b.find("table:visible").length?c(a,100):d.resolve()}var d=g.defer();c(a);return d.promise}function m(){b.find("thead th .th-inner").length||
b.find("thead th").wrapInner('<div class="th-inner"></div>');b.find("table th .th-inner").each(function(a,d){d=$(d);var e=d.outerWidth()-d.width(),e=d.parent().width()-e,c=b.find("table th:visible:last");if("center"!==c.css("text-align")){var h=b.find(".scrollArea").height()<b.find("table").height();c[0]==d.parent()[0]&&h&&(e+=b.find(".scrollArea").width()-b.find("tbody tr").width())}d.css("width",e);(e=d.parent().attr("title"))||(e=d.children().length?d.find(".title .ng-scope").html():d.html());
d.attr("title",e.trim())});n.resolve()}this.getSortCol=function(){return a.sortAttr};this.isAsc=function(){return a.asc};this.setSortCol=function(b){a.asc=!0;a.sortAttr=b};this.toggleSort=function(){a.asc=!a.asc};this.doSort=function(b){b?a.rows.sort(function(d,c){var f=b(d,c);return a.asc?f:-1*f}):a.rows.sort(function(b,c){var f;f=b[a.sortAttr];var h=c[a.sortAttr];f=f===h?0:f>h?1:-1;return a.asc?f:-1*f})};a.$on("rowSelected",function(a,c){var e=b.find(".scrollArea table tr[row-id='"+c+"']");1===
e.length&&g.all([l(),n.promise]).then(function(){var a=b.find(".headerSpacer").height(),c=b.find(".scrollArea").scrollTop();b.find(".scrollArea").scrollTop(c+e.position().top-a)})});var n=g.defer();$(window).resize(m);a.$watch("rows",function(b,a){b&&l().then(m)});a.asc=!k.hasOwnProperty("desc");a.sortAttr=k.sortAttr;b.find(".scrollArea").scroll(function(a){b.find("thead th .th-inner").css("margin-left",0-a.target.scrollLeft)})}]}}]).directive("sortableHeader",function(){return{transclude:!0,scope:!0,
require:"^scrollableTable",template:'<div ng-mouseenter="enter()" ng-mouseleave="leave()"><div class="title" ng-transclude></div><span class="orderWrapper"><span class="order" ng-show="focused || isActive()" ng-click="toggleSort()"><i ng-show="isAscending()" class="icon-arrow-up"></i><i ng-show="!isAscending()" class="icon-arrow-down"></i></span></span></div>',link:function(c,g,a,b){c.isActive=function(){return b.getSortCol()===a.col};c.toggleSort=function(){c.isActive()?b.toggleSort():b.setSortCol(a.col);
b.doSort(c[a.comparatorFn])};c.isAscending=function(){return c.focused&&!c.isActive()?!0:b.isAsc()};c.enter=function(){c.focused=!0};c.leave=function(){c.focused=!1}}}})})(angular);