(function(l){l.module("scrollable-table",[]).directive("scrollableTable",["$timeout",function(a){return{transclude:!0,restrict:"E",scope:{rows:"=watch",sortFn:"="},template:'<div class="scrollableContainer"><div class="headerSpacer"></div><div class="scrollArea" ng-transclude></div></div>',controller:["$scope","$element","$attrs",function(c,b,e){function g(){function c(){0===b.find("table:visible").length?a(c,100):d.resolve()}var d=$q.defer();a(c);return d.promise}function h(){b.find("thead th .th-inner").length||
b.find("thead th").wrapInner('<div class="th-inner"></div>');b.find("table th .th-inner").each(function(c,d){d=$(d);var f=d.outerWidth()-d.width(),f=d.parent().width()-f,a=b.find("table th:visible:last")[0]==d.parent()[0],e=b.find(".scrollArea").height()<b.find("table").height();a&&e&&(f+=18);d.css("width",f);f=d.parent().attr("title");d.children().length&&(f=d.find(".title .ng-scope").html());f||(f=d.html());d.attr("title",f)});k.resolve()}this.getSortCol=function(){return c.sortAttr};this.isAsc=
function(){return c.asc};this.setSortCol=function(a){c.asc=!0;c.sortAttr=a};this.toggleSort=function(){c.asc=!c.asc};this.doSort=function(a){a?c.rows.sort(function(d,f){var b=a(d,f);return c.asc?b:-1*b}):c.rows.sort(function(d,a){var b;b=d[c.sortAttr];var e=a[c.sortAttr];b=b===e?0:b>e?1:-1;return c.asc?b:-1*b})};c.$on("rowSelected",function(a,d){var c=b.find(".scrollArea table tr[row-id='"+d+"']");1===c.length&&$q.all([g(),k.promise]).then(function(){var a=b.find(".headerSpacer").height(),d=b.find(".scrollArea").scrollTop();
b.find(".scrollArea").scrollTop(d+c.position().top-a)})});var k=$q.defer();$(window).resize(h);c.$watch("rows",function(a,b){a&&g().then(h)});c.asc=!e.hasOwnProperty("desc");c.sortAttr=e.sortAttr}]}}]).directive("sortableHeader",function(){return{transclude:!0,scope:!0,require:"^scrollableTable",template:'<div ng-mouseenter="enter()" ng-mouseleave="leave()"><div class="title" ng-transclude></div><span class="orderWrapper"><span class="order" ng-show="focused || isActive()" ng-click="toggleSort()"><i ng-show="isAscending()" class="icon-arrow-up"></i><i ng-show="!isAscending()" class="icon-arrow-down"></i></span></span></div>',
link:function(a,c,b,e){a.isActive=function(){return e.getSortCol()===b.col};a.toggleSort=function(){a.isActive()?e.toggleSort():e.setSortCol(b.col);e.doSort(a[b.comparatorFn])};a.isAscending=function(){return a.focused&&!a.isActive()?!0:e.isAsc()};a.enter=function(){a.focused=!0};a.leave=function(){a.focused=!1}}}})})(angular);